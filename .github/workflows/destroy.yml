# .github/workflows/terraform_destroy.yml 


name: Terraform Destroy GitHub Actions AWS

on:
   workflow_dispatch:
    
jobs:
    terraform: 
        runs-on: ubuntu-latest
        env:
         TF_VAR_destination: ${{ secrets.DESTINATION }}
         TF_VAR_filelocation_prtkey: ${{ secrets.FILELOCATION_PRTKEY }}
         TF_VAR_public_key_path: ${{ secrets.PUBLIC_KEY_PATH }}
         AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
         AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
         AWS_REGION: ${{ secrets.AWS_REGION }}

        steps:
            -  name: Checkout Code
               uses: actions/checkout@v2

            -  name: Set up Terraform
               uses: hashicorp/setup-terraform@v1
               with:
                    terraform_version: 1.10.5

            -  name: Terraform Init
               run: terraform init
               working-directory: ./terraform

            -  name: Terraform Destroy
               run: terraform destroy -auto-approve
               working-directory: ./terraform

            -  name: Clean up Terraform Files
               run: |
                 terraform state rm $( terraform state list)
                 rm -rf .terraform* terraform.tfstate*
               working-directory: ./terraform

